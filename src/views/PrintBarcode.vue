<template>
  <ToolBar>Print Barcode</ToolBar>
  <ion-content>
    <div class="controls">
      <label>Barcode Value:
        <input v-model="barcodeData" />
      </label>

      <label>
        Canvas Width (mm):
        <input
          type="number"
          v-model.number="canvasWidthMM"
          @change="updateCanvasSizeFromMM"
          min="10"
        />
      </label>

      <label>
        Canvas Height (mm):
        <input
          type="number"
          v-model.number="canvasHeightMM"
          @change="updateCanvasSizeFromMM"
          min="10"
        />
      </label>

      <ion-button @click="drawCanvas">Refresh</ion-button>
      <ion-button @click="onFindPrinter">Find Printer</ion-button>
      <ion-button @click="onConnectPrinter">Connect Printer</ion-button>
      <ion-button @click="resetPositions">Reset Positions</ion-button>
      <ion-button @click="printLabel">Print Label</ion-button>
      <ion-button @click="sendToPrinter">Print HTML</ion-button>
    </div>

    <canvas id="canvas" ></canvas>
  </ion-content>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue'
 
import { CapacitorThermalPrinter } from 'capacitor-thermal-printer'
            
async function onFindPrinter() {
  CapacitorThermalPrinter.addListener('discoverDevices', (devices) => {
    console.log('Discovered printers:', devices)
  })
  await CapacitorThermalPrinter.startScan()
}

async function onConnectPrinter() {
  const result = await CapacitorThermalPrinter.connect({ address: "DC:0D:30:6F:9C:B4" })
  console.log('Connected:', result)
}
 
 
async function printLabel() {
      const img = new Image();
    img.src = './assets/nv_test.bmp';  // path to local asset

    img.onload = async () => {
      // Assuming 8 dots per mm: 30mm x 20mm = 240x160 dots
      const targetWidth = 240;
      const targetHeight = 160;

      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = targetWidth;
      canvas.height = targetHeight;
ctx.fillStyle = '#FFFFFF'; // white background
ctx.fillRect(0, 0, canvas.width, canvas.height);
 
      // Draw resized image
      ctx.drawImage(img, 0, 0, targetWidth, targetHeight);

      const imageData = ctx.getImageData(0, 0, targetWidth, targetHeight);
      const data = imageData.data;

      const bytesPerRow = Math.ceil(targetWidth / 8);
      const totalBytes = bytesPerRow * targetHeight;
      const tsplBitmap = new Uint8Array(totalBytes);

      for (let y = 0; y < targetWidth; y++) {
    for (let x = 0; x < targetHeight; x++) {
      const idx = (y * targetHeight + x) * 4;
      const r = data[idx];
      const g = data[idx + 1];
      const b = data[idx + 2];
      const avg = (r + g + b) / 3;
         const bit = avg > 128 ? 0 : 1;

      const byteIndex = y * bytesPerRow + (x >> 7);
      tsplBitmap[byteIndex] |= bit << (7 - (x % 8));
    }
  }
     

      const hexData = [0,0,0,0,0,132,1,9,99,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,224,0,0,0,0,0,0,0,1,14,3,3,87,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,240,0,0,0,0,0,0,0,2,20,2,0,85,191,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,248,0,0,0,0,0,0,0,4,44,4,0,63,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,0,0,0,0,0,0,0,8,88,4,0,63,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,16,176,0,2,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,128,0,0,0,0,0,0,49,96,0,2,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,249,224,0,0,0,0,0,0,34,224,0,3,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,112,0,0,0,0,0,0,69,192,0,2,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,56,0,0,0,0,0,0,138,128,0,34,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,30,0,0,0,0,0,1,21,128,0,32,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,15,0,0,0,0,0,0,41,0,0,2,255,255,255,255,255,255,255,255,255,255,255,223,255,255,255,255,255,255,255,7,128,0,0,0,0,2,82,0,0,5,255,255,255,255,255,255,255,255,255,255,255,207,255,255,255,255,255,255,255,131,128,0,0,0,0,4,198,2,0,4,255,255,255,255,255,255,255,255,255,255,255,207,255,255,255,255,255,255,255,129,192,0,0,0,0,9,4,4,0,5,255,255,255,255,255,255,255,255,255,255,255,207,255,255,255,255,255,255,255,193,224,0,0,0,0,2,8,4,0,15,255,255,255,255,255,255,255,255,255,255,255,135,255,255,255,255,255,255,255,224,224,0,0,0,0,19,0,8,0,11,255,255,255,255,255,255,255,255,255,255,255,135,255,255,255,255,255,255,255,240,240,0,0,0,0,38,16,16,0,11,255,255,255,255,255,255,255,255,255,255,255,131,255,255,255,255,255,255,255,240,96,0,0,0,0,76,32,32,0,11,255,255,255,255,255,255,255,255,255,255,255,3,255,223,255,255,255,255,254,248,96,0,0,0,0,88,0,64,0,31,255,255,255,255,255,255,255,255,255,255,255,1,255,223,255,251,255,255,254,124,192,0,0,0,0,144,0,128,0,31,255,255,255,255,255,253,255,255,255,255,254,1,255,239,255,255,255,255,255,124,192,0,0,0,1,32,0,0,0,23,255,255,255,255,255,253,255,255,255,254,254,0,255,231,255,250,255,255,255,191,128,0,0,0,1,96,129,0,0,23,255,255,255,255,255,249,255,255,255,252,252,0,255,247,255,243,255,255,255,159,128,0,0,0,0,193,2,0,0,23,255,255,255,255,255,249,255,255,255,252,252,0,127,243,255,245,199,255,255,223,0,0,0,0,0,129,4,0,0,23,255,255,255,255,255,241,255,255,255,248,248,0,63,243,255,249,231,255,255,223,0,0,0,0,1,128,0,0,0,31,255,255,255,255,247,225,255,255,255,240,248,0,31,249,255,253,55,255,255,239,0,0,0,0,7,0,0,0,0,63,255,255,255,255,239,195,255,255,255,225,240,0,31,249,255,255,127,255,255,239,0,0,0,0,6,0,16,0,0,63,255,255,255,255,143,195,255,255,255,193,240,0,15,248,255,255,135,255,255,231,128,0,0,0,6,4,32,0,0,63,255,255,255,255,31,131,255,255,255,129,224,0,7,252,127,255,247,255,255,231,128,0,0,0,12,4,64,0,0,55,255,255,255,254,31,3,255,255,255,3,192,0,3,252,127,255,255,255,255,167,128,0,0,0,12,0,0,0,0,18,191,255,255,252,63,7,255,255,254,3,192,0,3,254,63,255,255,255,255,167,128,0,0,0,28,8,0,0,0,0,191,255,255,224,62,7,255,255,248,7,128,0,1,254,31,255,255,255,255,39,128,0,0,0,20,0,0,0,0,1,127,255,255,128,120,7,255,255,224,7,0,0,0,254,31,255,255,247,255,103,128,0,0,0,32,2,0,0,0,1,110,255,254,0,112,15,255,255,192,14,0,0,0,126,15,255,255,227,255,231,128,0,0,0,40,4,0,0,0,1,110,255,252,0,224,15,255,255,0,24,0,0,0,127,3,255,255,239,255,207,0,0,0,0,72,0,1,0,0,5,111,255,248,1,192,15,255,254,0,24,0,0,0,63,1,255,255,255,255,207,0,0,0,0,72,16,0,16,64,21,127,255,240,3,128,15,255,254,0,48,0,0,0,7,129,255,255,223,255,222,0,0,0,0,136,32,4,0,64,23,127,255,224,2,0,31,255,248,0,96,0,0,0,7,128,255,255,223,255,254,0,0,0,0,136,32,4,0,128,23,127,255,224,0,0,31,255,224,0,192,0,0,0,3,128,255,255,255,255,252,0,0,0,0,136,64,8,0,128,31,127,255,192,0,0,31,255,128,1,128,0,0,0,1,192,255,239,191,255,248,0,0,0,0,0,128,0,0,128,31,255,255,0,0,0,63,198,0,3,0,0,0,0,0,64,255,239,191,255,240,0,0,0,1,1,0,0,1,0,31,255,254,0,16,0,0,0,0,6,0,0,0,0,0,0,255,239,255,255,224,0,0,0,0,2,0,0,1,0,31,254,252,0,0,0,0,0,0,12,0,0,0,0,0,0,254,167,255,255,240,0,0,0,0,0,0,0,2,0,15,254,248,0,96,0,0,0,0,0,0,0,255,128,0,0,124,15,255,255,248,0,0,0,0,0,2,0,2,0,95,252,224,127,255,0,0,0,0,0,0,3,255,253,0,0,64,79,255,255,252,0,0,0,0,0,0,0,2,0,127,252,3,255,255,224,0,0,0,0,0,15,192,7,242,0,0,15,255,255,238,0,0,0,0,0,0,0,6,0,127,240,15,224,0,104,0,0,0,0,0,60,0,1,200,0,4,175,255,255,231,0,0,0,0,0,32,0,4,0,127,128,191,128,0,28,0,0,0,0,0,112,31,224,116,0,32,127,255,255,227,128,0,0,0,128,64,0,12,0,127,1,126,7,254,6,0,0,0,0,0,192,127,252,51,0,34,255,255,255,195,192,0,0,0,0,128,0,12,0,127,0,248,31,207,129,0,0,0,0,1,129,240,255,14,128,3,255,255,255,193,192,0,0,4,0,0,0,8,1,255,1,240,127,131,224,128,0,0,0,1,7,224,127,135,64,1,255,255,255,129,224,0,0,0,25,0,0,24,1,63,3,224,255,131,240,0,0,0,0,0,15,224,255,195,224,17,255,255,255,193,224,0,0,0,34,16,0,24,0,63,19,193,255,135,248,0,0,0,0,0,15,241,255,225,224,16,255,255,255,241,224,0,0,0,64,0,0,16,0,63,6,131,255,255,252,0,0,0,0,0,31,255,255,240,240,16,127,255,255,223,224,0,0,0,4,32,0,48,0,63,13,135,255,255,252,0,0,0,0,0,31,255,255,240,160,8,127,255,255,195,224,0,0,192,8,0,0,32,0,63,15,7,255,255,254,0,0,0,0,0,63,255,255,248,32,8,24,15,255,224,224,0,0,0,0,64,0,32,0,63,143,15,255,255,242,0,0,0,0,0,63,255,255,192,32,8,32,135,255,241,224,0,0,0,16,0,0,97,0,127,142,9,239,254,240,0,0,0,0,0,39,255,255,192,0,4,33,103,255,251,224,0,0,0,32,0,0,64,0,127,206,8,143,255,224,0,0,0,0,0,35,159,251,128,64,4,70,39,255,255,192,0,0,0,96,128,0,130,0,126,202,0,135,252,0,0,0,0,0,0,16,143,227,0,0,6,200,23,255,255,128,0,0,0,64,128,0,132,8,127,196,4,7,252,0,0,0,0,0,0,16,131,192,0,0,3,144,7,255,255,0,0,0,0,144,0,1,136,8,127,224,2,0,112,0,0,0,0,0,0,8,1,0,0,0,1,48,15,255,255,128,0,0,1,16,0,1,8,16,111,224,3,0,0,0,0,0,0,0,0,4,0,0,128,0,0,32,15,255,255,192,0,0,2,32,0,1,16,0,237,240,1,128,0,32,0,0,0,0,0,2,0,0,0,0,0,32,47,255,255,224,0,0,4,100,0,2,32,33,234,240,0,192,0,0,0,0,0,0,0,0,128,0,0,0,0,96,47,255,255,240,0,0,8,97,0,2,64,33,114,240,0,48,0,0,0,0,0,0,0,0,48,16,0,0,0,97,79,255,255,252,0,0,16,192,0,4,128,65,112,120,0,14,0,0,0,0,0,0,0,0,63,248,0,0,0,162,31,255,251,252,0,0,16,192,0,1,0,65,96,120,0,23,224,0,0,0,0,0,0,0,14,0,0,0,0,114,159,255,253,254,0,0,33,72,0,2,0,1,100,60,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,56,31,255,252,255,0,0,82,200,0,0,0,131,228,60,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,24,31,255,252,255,0,0,66,200,0,0,1,130,148,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,8,63,255,254,127,0,0,166,200,0,16,1,2,140,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,6,127,255,254,127,128,0,4,202,0,32,3,2,164,10,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,3,255,255,255,63,128,0,68,200,0,0,2,2,144,14,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,255,255,255,63,192,1,0,192,0,128,6,5,152,15,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,2,127,255,255,159,192,1,136,64,0,0,12,5,12,13,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,13,159,255,255,159,192,1,136,64,2,0,12,5,34,5,0,0,0,0,0,0,0,0,0,0,0,0,0,14,0,27,199,255,254,223,192,1,136,96,4,0,8,10,67,133,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,240,255,252,223,192,1,136,32,8,32,24,11,199,101,0,0,0,0,0,0,0,0,0,0,0,0,0,16,1,255,255,255,252,207,192,0,136,32,16,96,16,10,0,37,0,0,0,0,0,0,0,0,0,0,0,0,0,32,7,255,255,255,252,207,192,0,136,24,32,128,16,6,0,21,128,0,0,0,0,0,4,0,0,0,0,0,0,64,31,255,255,255,252,207,192,0,136,6,65,128,32,23,0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,64,255,255,255,255,248,207,192,0,140,0,131,0,32,5,224,5,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,248,207,192,0,136,1,2,64,32,6,204,13,0,0,0,0,0,0,0,0,0,0,0,0,1,255,255,255,255,255,248,207,192,0,72,2,4,64,32,10,229,255,0,0,0,0,0,0,0,0,0,0,0,32,1,255,255,255,255,255,241,207,192,0,36,132,8,64,64,9,100,255,0,0,0,0,0,0,0,0,0,0,0,0,3,255,255,255,255,255,227,143,128,0,16,68,0,128,64,9,96,207,128,0,0,0,0,0,0,0,0,0,0,0,7,255,255,255,255,255,195,15,128,0,1,8,16,0,64,0,48,127,128,0,0,0,0,0,0,0,0,0,0,0,15,255,255,255,255,255,134,31,0,0,0,8,8,0,64,16,176,122,64,0,0,0,0,0,0,0,0,0,0,0,31,255,255,255,255,254,12,30,0,0,0,16,8,64,64,24,88,18,32,0,0,0,0,0,0,0,0,0,0,0,63,255,255,255,255,252,48,60,0,0,0,16,88,32,64,24,12,54,144,0,0,0,0,0,124,0,0,0,0,0,127,255,255,246,255,243,192,120,0,0,0,16,72,16,64,24,38,111,8,0,0,0,0,7,129,192,0,0,0,0,255,255,255,191,255,192,0,224,0,0,0,16,36,0,64,12,2,89,132,0,0,0,0,6,0,96,0,0,8,1,255,255,255,238,254,0,0,0,0,0,0,0,128,0,0,12,1,144,194,0,0,0,0,1,0,192,0,0,8,3,255,255,247,255,248,0,0,0,0,0,0,16,128,0,32,42,2,32,97,0,0,0,0,0,0,0,0,0,8,7,255,255,136,56,224,0,0,0,0,0,0,16,192,2,0,1,4,204,112,128,0,0,0,0,0,0,0,0,12,27,255,255,8,24,0,0,0,0,0,0,0,16,0,3,16,4,1,3,48,96,0,0,0,0,0,0,0,0,12,49,255,254,20,24,0,0,0,0,0,0,0,16,128,2,16,8,96,0,120,240,0,0,0,0,0,0,0,0,15,193,255,252,4,44,0,0,0,0,0,0,0,8,192,2,0,31,192,0,96,92,0,0,0,0,60,0,0,0,7,193,255,240,1,2,0,0,0,0,0,0,0,8,192,6,32,0,0,0,196,94,0,0,0,0,0,0,0,0,1,255,255,224,0,1,0,0,0,0,0,0,0,4,192,4,1,0,136,3,4,80,128,0,0,0,0,0,0,0,0,127,255,224,0,0,0,0,0,0,0,0,0,4,64,16,0,0,0,2,4,96,48,0,0,0,0,0,0,0,32,15,227,224,0,0,0,0,0,0,0,0,0,2,64,0,0,11,0,0,6,192,28,0,0,0,0,0,0,1,128,0,1,112,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,0,13,0,0,0,0,0,0,7,0,0,0,240,0,0,0,0,0,0,0,0,0,0,32,0,0,0,0,0,4,0,12,96,0,0,0,0,0,30,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,8,0,0,0,0,0,102,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,1,0,0,0,0,0,134,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,12,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,112,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,1,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,48,0,12,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,14,0,224,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,1,255,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,56,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,200,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,136,0,0,0,0,0,0,8,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,104,0,0,0,0,0,0,8,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,104,0,0,0,0,0,0,8,176,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,56,0,0,0,0,0,0,4,208,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,48,0,0,0,0,0,0,5,200,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,48,0,0,0,0,0,0,7,132,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,48,0,0,0,0,0,0,7,68,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,48,0,0,0,0,0,0,6,130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,24,0,0,0,0,0,0,7,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,144,12,0,0,0,0,0,0,14,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,6,0,0,0,0,0,0,24,0,12,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,3,0,0,0,0,0,0,48,0,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,96,0,1,128,0,0,0,0,0,64,0,3,145,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,192,0,0,192,0,0,0,0,0,128,0,2,48,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,128,0,0,32,0,0,0,0,1,0,0,4,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,62,128,0,0,24,0,0,0,0,2,0,0,4,19,134,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,196,64,0,0,4,0,0,0,0,12,0,0,4,48,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,33,140,64,0,0,2,0,0,0,0,24,0,0,4,32,24,0,0,0,1,231,255,224,0,2,0,0,0,0,0,6,12,64,0,0,1,128,0,0,0,48,0,0,8,112,0,0,0,0,48,0,0,14,0,112,0,0,0,32,0,12,28,32,0,0,0,192,0,0,0,96,0,0,8,78,0,0,0,0,0,0,0,0,1,128,0,0,0,0,0,80,100,32,0,0,0,48,0,0,1,128,0,0,8,195,128,0,0,0,0,0,0,0,0,7,192,0,0,0,0,65,132,16,0,0,0,24,0,0,2,0,0,0,16,176,96,0,0,0,0,0,0,0,8,0,0,0,0,0,0,70,2,16,0,0,0,6,0,0,12,0,0,0,17,28,8,0,0,0,0,0,0,0,96,0,0,0,0,0,0,12,7,8,0,0,0,1,0,0,24,0,0,0,17,131,2,0,0,0,0,0,0,0,128,0,0,0,0,0,0,48,29,4,0,0,0,0,192,0,112,0,0,0,34,112,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,32,48,132,0,0,0,0,48,1,128,0,0,0,38,24,0,0,0,0,96,0,0,0,0,0,0,0,0,0,0,32,192,194,0,0,0,0,4,4,0,0,0,0,71,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,129,225,0,0,0,0,1,24,0,0,0,0,72,192,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,3,33,0,0,0,0,0,150,0,0,0,0,152,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,12,16,128,0,0,0,2,56,128,0,0,0,166,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,120,64,0,0,0,13,192,64,0,0,1,65,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,193,196,96,0,0,0,30,0,96,0,0,2,64,112,0,0,0,0,0,0,7,128,0,0,0,0,0,0,0,0,7,14,48,0,0,0,56,0,32,0,0,4,176,28,0,0,0,0,0,0,48,0,0,0,0,0,0,0,96,0,12,57,16,0,0,0,112,0,16,0,0,5,14,0,0,0,0,0,0,0,192,0,0,0,0,0,0,0,192,0,48,96,136,0,0,0,160,64,8,0,0,10,3,128,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,1,131,68,0,0,1,48,192,4,0,0,24,192,96,0,0,0,0,0,24,2,0,0,0,0,0,0,0,16,0,71,14,50,0,0,2,33,32,2,0,0,48,48,24,0,0,0,0,0,16,32,0,0,0,0,0,0,0,0,0,12,24,25,128,0,4,32,33,33,0,0,124,12,16,0,0,0,0,0,32,16,0,0,0,0,0,0,0,0,0,8,96,34,64,0,8,33,129,0,128,0,135,3,32,0,0,0,0,0,64,2,0,1,128,0,0,0,0,0,0,5,128,193,32,0,16,32,1,0,64,1,129,192,192,0,0,0,0,0,128,0,0,0,192,0,0,0,0,0,0,3,1,1,208,0,32,32,1,0,32,2,96,48,0,0,0,0,0,1,0,0,0,0,96,0,0,0,0,0,0,0,6,7,28,0,64,32,0,0,16,4,28,8,0,0,0,0,0,3,0,0,0]

 
 const tsplLabel = `
  SIZE 30 mm,20 mm
  GAP 2 mm,0
  DENSITY 8
  DIRECTION 0
  CLS
BITMAP 20,20,30,150,0,${hexData}
  PRINT 1
`;
 

      const encoder = new TextEncoder();
      const rawData = encoder.encode(tsplLabel);

      try {
        await CapacitorThermalPrinter.begin().raw(rawData).write();
        console.log("Print sent!");
      } catch (e) {
        console.error("Printing error:", e);
        alert("Failed to print: " + e.message);
      }
    };

    img.onerror = () => {
      alert("Failed to load image.");
    };
  }
  
</script>

 